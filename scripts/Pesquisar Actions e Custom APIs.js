javascript:(function(){const SPACE_CHAR='\u0020';const NEWLINE_CHAR='\u000A';function createElement(tag,styles,textContent='',attributes={}){const el=document.createElement(tag);for(const style in styles){el.style[style]=styles[style];}el.textContent=textContent;for(const attr in attributes){el.setAttribute(attr,attributes[attr]);}return el;}function createMainModal(){const modal=createElement('div',{position:'fixed',top:'50%',left:'50%',transform:'translate(-50%,'+SPACE_CHAR+'-50%)',padding:'20px',backgroundColor:'#fff',boxShadow:'0'+SPACE_CHAR+'0'+SPACE_CHAR+'10px'+SPACE_CHAR+'rgba(0,0,0,0.5)',zIndex:'10000',borderRadius:'8px',fontFamily:'Arial,'+SPACE_CHAR+'sans-serif',maxHeight:'80%',overflowY:'auto',width:'min(90vw,'+SPACE_CHAR+'700px)',maxWidth:'70%'});const title=createElement('h3',{marginBottom:'15px',color:'#333',textAlign:'center'},'Pesquisar Actions e Custom APIs');modal.appendChild(title);const description=createElement('p',{fontSize:'0.9em',color:'#666',textAlign:'center',marginBottom:'15px'},'Digite'+SPACE_CHAR+'o'+SPACE_CHAR+'nome'+SPACE_CHAR+'da'+SPACE_CHAR+'Action'+SPACE_CHAR+'ou'+SPACE_CHAR+'Custom'+SPACE_CHAR+'API'+SPACE_CHAR+'(ex: `cr428_MinhaApi`)'+SPACE_CHAR+'e'+SPACE_CHAR+'pressione'+SPACE_CHAR+'Enter'+SPACE_CHAR+'ou'+SPACE_CHAR+'clique'+SPACE_CHAR+'em'+SPACE_CHAR+'"Pesquisar".');modal.appendChild(description);return modal;}function createSearchContainer(){const container=createElement('div',{display:'flex',gap:'10px',marginBottom:'15px',alignItems:'center'});const input=createElement('input',{flexGrow:'1',padding:'10px',border:'1px solid #ccc',borderRadius:'4px'},'',{type:'text',placeholder:'Nome'+SPACE_CHAR+'da'+SPACE_CHAR+'Action'+SPACE_CHAR+'ou'+SPACE_CHAR+'Custom'+SPACE_CHAR+'API...'});const button=createElement('button',{padding:'10px'+SPACE_CHAR+'15px',border:'none',borderRadius:'4px',backgroundColor:'#0078d4',color:'#fff',cursor:'pointer',transition:'background-color'+SPACE_CHAR+'0.2s'},'Pesquisar');button.onmouseover=function(){this.style.backgroundColor='#005a9e';};button.onmouseout=function(){this.style.backgroundColor='#0078d4';};container.appendChild(input);container.appendChild(button);return {container,input,button};}function createResultContainer(){return createElement('div',{maxHeight:'480px',overflowY:'scroll',border:'1px'+SPACE_CHAR+'solid'+SPACE_CHAR+'#eee',borderRadius:'4px',padding:'10px',marginBottom:'15px',textAlign:'left'});}function createCloseButton(modal){const closeButton=createElement('button',{padding:'10px'+SPACE_CHAR+'20px',border:'none',borderRadius:'4px',backgroundColor:'#dc3545',color:'#fff',cursor:'pointer',float:'right'},'Fechar');closeButton.onclick=()=>document.body.removeChild(modal);return closeButton;}async function search(actionName){if(!actionName){return {type:'none',results:[]};}const globalContext=Xrm.Utility.getGlobalContext();const clientUrl=globalContext.getClientUrl();const customApiFetchXml=`<fetch><entity name='customapi'><attribute name='uniquename'/><link-entity name='plugintype' from='plugintypeid' to='plugintypeid' link-type='inner' alias='plugintype'><attribute name='name'/></link-entity><filter><condition attribute='uniquename' operator='eq' value='${actionName}'/></filter></entity></fetch>`;const customApiUrl=`${clientUrl}/api/data/v9.2/customapis?fetchXml=${encodeURIComponent(customApiFetchXml)}`;try{const customApiResponse=await fetch(customApiUrl,{method:'GET',headers:{'OData-MaxVersion':'4.0','OData-Version':'4.0','Accept':'application/json','Content-Type':'application/json; charset=utf-8',}});const customApiData=await customApiResponse.json();if(customApiData.value&&customApiData.value.length>0){return {type:'customapi',results:customApiData.value};}}catch(error){console.error('Erro ao buscar como Custom API:',error);}const actionFetchXml=`<fetch><entity name='sdkmessageprocessingstep'><attribute name='name'/><link-entity name='sdkmessage' from='sdkmessageid' to='sdkmessageid' link-type='inner' alias='message'><attribute name='name'/><filter><condition attribute='name' operator='eq' value='${actionName}'/></filter></link-entity></entity></fetch>`;const actionUrl=`${clientUrl}/api/data/v9.2/sdkmessageprocessingsteps?fetchXml=${encodeURIComponent(actionFetchXml)}`;try{const actionResponse=await fetch(actionUrl,{method:'GET',headers:{'OData-MaxVersion':'4.0','OData-Version':'4.0','Accept':'application/json','Content-Type':'application/json; charset=utf-8',}});const actionData=await actionResponse.json();if(actionData.value&&actionData.value.length>0){return {type:'action',results:actionData.value};}}catch(error){console.error('Erro ao buscar como Action:',error);}return {type:'none',results:[]};}function renderResults(container,searchResult,actionName){container.innerHTML='';const {type,results}=searchResult;if(results.length===0){container.appendChild(createElement('p',{textAlign:'center',color:'#777'},`Nenhum`+SPACE_CHAR+`resultado`+SPACE_CHAR+`encontrado`+SPACE_CHAR+`para`+SPACE_CHAR+`"`+actionName+`"`));return;}let infoText='';let infoLabel='';if(type==='customapi'){const pluginName=results[0]['plugintype.name'];infoLabel='Plugin:';infoText=pluginName||'N/A';}else if(type==='action'){const stepName=results[0].name;infoLabel='Step:';infoText=stepName||'N/A';}if(infoText&&infoText!=='N/A'){const actionDiv=createElement('div',{padding:'10px',marginBottom:'5px',border:'1px solid #ddd',borderRadius:'4px',backgroundColor:'#f9f9f9',display:'flex',flexDirection:'column'});const actionNameSpan=createElement('span',{fontWeight:'bold',color:'#005a9e',marginBottom:'5px'},actionName);actionDiv.appendChild(actionNameSpan);const infoSpan=createElement('span',{fontSize:'0.9em',color:'#555'},`${infoLabel}`+SPACE_CHAR+`${infoText}`);actionDiv.appendChild(infoSpan);container.appendChild(actionDiv);}else{container.appendChild(createElement('p',{textAlign:'center',color:'#777'},`Nenhum`+SPACE_CHAR+`resultado`+SPACE_CHAR+`encontrado`+SPACE_CHAR+`para`+SPACE_CHAR+`"`+actionName+`"`));}}const modal=createMainModal();const {container:searchContainer,input:searchInput,button:searchButton}=createSearchContainer();const resultContainer=createResultContainer();const performSearch=async ()=>{const actionName=searchInput.value.trim();if(actionName){resultContainer.innerHTML='';const loadingMessage=createElement('p',{textAlign:'center',color:'#555',padding:'20px'},'Buscando...'+SPACE_CHAR+'Por'+SPACE_CHAR+'favor,'+SPACE_CHAR+'aguarde.');resultContainer.appendChild(loadingMessage);try{const searchResult=await search(actionName);renderResults(resultContainer,searchResult,actionName);}catch(error){resultContainer.innerHTML=`<p style="color:red;text-align:center;">Erro`+SPACE_CHAR+`na`+SPACE_CHAR+`busca:`+NEWLINE_CHAR+`${error.message}</p>`;console.error(error);}}};modal.appendChild(searchContainer);modal.appendChild(resultContainer);modal.appendChild(createCloseButton(modal));document.body.appendChild(modal);searchInput.focus();searchButton.addEventListener('click',performSearch);searchInput.addEventListener('keydown',function(e){if(e.key==='Enter'){performSearch();}});})()
